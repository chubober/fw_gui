<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>FW GUI</title>
    <link rel="stylesheet" href="/static/css/bootstrap-4.5.2.min.css" type="text/css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">


    <link rel="stylesheet" href="/static/css/boxit.css" type="text/css">
    <link rel="stylesheet" href="/static/css/styles.css" type="text/css">


</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
    <div class="container">
      <a class="navbar-brand" href="/">FW GUI</a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="/corps">Corpora</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="/upload">Upload data</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <!-- Page Content -->
{% for cat, msg in get_flashed_messages(True) %}
<div class = 'flash {{cat}}'>{{msg}}</div>
{% endfor %}
<br>
<h1 class="text-center">{{corp_name}}</h1>
<form action="{{url_for('corp_result', corp_id=corp_id)}}" target="_blank" method="GET" autocomplete="off" class="container-fluid mt-xl-4">
  <div id="sections" class="row flex-row flex-nowrap scroll">
    <div class="col col-md-4 col-12 section card pt-xl-3">
      {% for text_input in text_list %}
      <div id = "duplicater{{text_input}}" class = 'form-group'>
        <label>{{text_input}}</label>
        
        <div id="duplicater_{{text_input}}" class = 'form-group' name = "duplic">

        <input class="form-control" name="1_{{text_input}}" list="{{text_input}}" id="{{text_input}}">
        <select id = '1' required class="selectpicker" data-actions-box="true" tabindex="-98" name="1_{{text_input}}"  data-selected-text-format="count" data-width="fit" data-container="body">
          <option selected value="and">AND</option>
          <option selected value="or">OR</option>
        </select>
        <div>
        <button id = '{{text_input}}_button' type="button" class = 'button' name = 'pl' onclick = 'addDiv(this)'>+</button>
        </div>
        <!--
        <button id = '{{text_input}}_button_and' type="button" onclick = 'duplicate(this); click_and(document.getElementsByName("1_{{text_input}}"))' class = 'button-and' name = 'and'>AND</button>
        <input name = 'and' id = "{{text_input}}_and" type = "hidden" value = 'and'>
        <button id = '{{text_input}}_button_or' type="button" onclick = 'duplicate(this, "or"); click_or(document.getElementsByName("1_{{text_input}}"))' class = 'button-or' name = 'or'>OR</button>
        <input name = 'or' id = "{{text_input}}_or" type = "hidden" value = ''>
        <button id = '{{text_input}}_button_not' type="button" class = 'button-not' name = 'not' onclick = 'click_not(document.getElementsByName("1_{{text_input}}"))'>NOT</button>
        <input name = 'not' id = "{{text_input}}_not" type = "hidden" value = ''>
      -->
        <br>
      </div>
    </div>
      {% endfor %}
      {% for sel_input, rec_list in recs.items() %}
      <div class="form-group" id = "aft">
          <label>{{sel_input}}</label>
          <select required multiple class="selectpicker" data-actions-box="true" tabindex="-98" name="1_{{sel_input}}" multiple data-selected-text-format="count" data-width="fit" data-container="body">
              {% for rec in rec_list %}
	            {% if rec == '' %}
              <option selected value="{{ rec }}">Not defined</option>
              {% else %}
              <option selected value="{{ rec }}">{{ rec }}</option>
              {% endif %}
              {% endfor %}
          </select>
      </div>
      {% endfor %}

      <div class="form-group">
        <button type="button" class='btn btn-danger remove'>remove section</button>
        <button type="button" class="btn btn-primary addsection">add section</button>
      </div>

    </div>
  </div>

  <br>
    <div class="d-flex justify-content-start">
      <button type="submit" class="btn btn-success">search</button>
    </div>
  </form>

  <!-- Initialize the plugin: -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
  <script  src="/static/js/double.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
  var i = 0;
  var countOfFields = 1; 
  var curFieldNameId = 1;

  function addDiv(elem){
    text = elem.id.split('_')[0]
    console.log(text);
    countOfFields++;
    curFieldNameId++;
    // Создаем элемент ДИВ
    var div = document.createElement("div");
    var input = document.createElement('input');
    input.name = curFieldNameId+'_'+text;
    input.class = 'form-control';
    var select = document.createElement('select');
    select.required = true;
    select.width = '100px'
    //select.find('.bootstrap-select').replaceWith(function() { return $('select', this); });
    //select.find('.selectpicker').selectpicker();
    //select.classList.add('selectpicker')
    select.name = curFieldNameId+'_'+text
    select.innerHTML = '<option selected value="and">AND</option><option selected value="or">OR</option>'
    var btn = document.createElement('button')
    btn.innerHTML = '<button id = "'+text+'_button" type="button" class = "button" name = "pl" onclick = "addDiv(this)">+</button>'
    //btn.name = "plus";
    //btn.id = curFieldNameId
    //btn.type = 'button'
    //btn.addEventListener('click', addDiv(this, text))
    //btn.innerHTML='+'

    div.appendChild(input)
    div.appendChild(select)
    div.appendChild(btn)
    console.log(div)
    document.getElementById("duplicater"+text).appendChild(div);
    // Возвращаем false, чтобы не было перехода по сслыке
    return false;
  }

  function duplicate(elem) {
    var par_el = elem.parentElement.id;
    var original = document.getElementById(par_el);
    var clone = original.cloneNode(true); // "deep" clone
    clone.style.background = 'white';
    clone.id = "duplicator" + ++i; // there can only be one element with an ID
    original.parentNode.appendChild(clone);
    console.log(clone)
    var text_value = clone.childNodes.item(1).value
    var tup = [text_value]
    console.log(tup)
  }


  function click_and(elem) {
  console.log(elem[0])
  elem[0].style.background = '#BCF99E';
  }

  function click_or(elem) {
     elem[0].style.background = '#F9F79E';
  }
    
  function click_not(elem) {
  console.log(elem[0])
  elem[0].style.background = '#959595';
  }

  </script>

</body>

</html>

